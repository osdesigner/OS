<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحة الدفع</title>
    <link rel="stylesheet" href="style-data.css">
    <script src="maseg.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- أضف Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
     <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script>

document.addEventListener("DOMContentLoaded", function () {
    const columns = document.querySelectorAll(".footer-column h4");
    columns.forEach(column => {
        column.addEventListener("click", function () {
            let parent = this.parentElement;
            parent.classList.toggle("open");
        });
    });
});

</script>
</head>
<body>


<div class="header">
        <a href="https://os-desin.vercel.app"> <img src="logo.png" alt="لوجو الموقع" class="logo"> </a><!-- هنا ضع رابط الصورة -->
        <div class="nav" id="nav">
          <a href="">checkout</a>
        </div> 
</div>





       <div class="container">
        <!-- رأس الصفحة -->
        <div class="checkout-header">
            <h1>إتمام عملية الشراء</h1>
            <p>الرجاء تعبئة معلومات الدفع لإكمال طلبك</p>
            
            <!-- شريط التقدم -->
                 <div class="progress-steps">
            <div class=" step active">
                          <div class="progress-bar" style="width: 100%;"></div>

                <div class="step-icon">1</div>
                <span class="step-title">عربة التسوق</span>
            </div>
            <div class="step active">
                <div class="step-icon">2</div>
                <span class="step-title">معلومات الشحن</span>
            </div>
        </div>
        </div>
        
        <!-- قسم معلومات العميل -->
  <div class="customer-info">
            <h2 class="section-title"><i class="fas fa-user-circle"></i> معلومات العميل</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="first-name">الاسم الأول</label>
                    <input type="text" id="first-name" placeholder="أدخل اسمك الأول">
                    <div class="error-message">هذا الحقل مطلوب</div>
                </div>
                
                <div class="form-group">
                    <label for="last-name">الاسم الأخير</label>
                    <input type="text" id="last-name" placeholder="أدخل اسمك الأخير">
                    <div class="error-message">هذا الحقل مطلوب</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="email">البريد الإلكتروني</label>
                <input type="email" id="email" placeholder="أدخل بريدك الإلكتروني">
                <div class="error-message">الرجاء إدخال بريد إلكتروني صحيح</div>
            </div>
            
            <div class="form-group">
                <label for="phone">رقم الهاتف</label>
                <input type="tel" id="phone" placeholder="أدخل رقم هاتفك">
                <div class="error-message">الرجاء إدخال رقم هاتف صحيح</div>
            </div>
            
            
            <div class="form-row">
                <div class="form-group">
                    <label for="city">العنوان كامل</label>
                    <input type="text" id="city" placeholder="المحافظه - المدينه - الشارع او الحي">
                    <div class="error-message">هذا الحقل مطلوب</div>
                </div>
                
              
</div>
            <h2 class="section-title" style="margin-top: 2rem;"><i class="fas fa-truck"></i> معلومات الشحن</h2>
            
           
            
            <div class="form-group">
                <label for="notes">ملاحظات إضافية (اختياري)</label>
                <textarea id="notes" rows="2" placeholder=" مثل تفاصيل خاصة بالتسليم"></textarea>
            </div>
        </div>
        
        <!-- قسم ملخص الطلب -->
        <div class="order-summary">
            <h2 class="section-title"><i class="fas fa-receipt"></i> ملخص الطلب</h2>
            
            <div class="order-items" id="order-items-container">
                <!-- سيتم ملء هذا القسم بالمنتجات من localStorage -->
            </div>
            
            <div class="order-totals" id="order-totals-container">
                <!-- سيتم ملء هذا القسم بالمجموع من localStorage -->
            </div>

            


           
            
            <!-- قسم طرق الدفع -->
            <div class="payment-methods">
                <h2 class="section-title"><i class="fas fa-credit-card"></i> طريقة الدفع</h2>
                
                <div class="payment-options">
                    <div class="payment-option ">
                        
                      
                    
                    <div class="payment-option active ">
                        <div class="payment-icon active">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <label for="cash">الدفع بفودافون كاش </label>
                        
                        <div class="payment-details">
                            <p>سيتم تحصيل المبلغ المتبقي عند استلام الطلب</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="terms">
                <input type="checkbox" id="agree-terms" checked>
                <label for="agree-terms">أوافق على            <a href="#agree-terms" onclick="showTerms()">الشروط والأحكام</a>
 وسياسة الخصوصية</label>

<div id="termsBox" class="hidden">
  <button class="closeBtn" onclick="hideTerms()">✖</button>
  <p>
    ✅ باستخدام موقع OS-Designer يجب مراعه الشروط الاتيه...
    <br>
    1- جميع الطلبات ملزمة بدفع مبلغ من المال قبل التنفيذ.<br>
    2- لا يمكن إرجاع المبلغ بعد البدء في التصميم.<br>
    3- يُرجى التأكد من صحة البيانات قبل إرسال الطلب. <br>
    4- في حالة وجود أي خطأ في البيانات، يجب التواصل معنا في أقرب وقت ممكن من اسفل الصفحه.<br>
    5- في حاله تأكيد البينات يرجي التحقق قبل طباعه اي شئ
  </p>
</div>
              </div>
            
       <p class="p-cash" style="font-size: 18px; font-weight: 900;">يرجي قرائه الشروط و الاحكام قبل الطلب</p>
<a href="http://vf.eg/vfcash?id=mt&qrId=4Lxe5J&qrString=f0add71bc86449b5cec1be4f054a42f1df4499af7aa3bead48e2fe5dacf0987a" class="cash">ادفع ب فودافون كاش</a>

<button class="submit-btn" type="button" onclick="submitOrder(event)">
  <i class="fas fa-box"></i> تأكيد الطلب
</button>

        </div>
    </div>

</div>


<footer class="footer">
    <div class="footer-top">
        <a href="os-desin.vercel.app" class="footer-logo">
            <img src="logo.png" alt="OS Logo">
        </a>
        <span>اطلب اردرك بكل سهوله</span>
    </div>
    <div class="footer-container">
        <div class="footer-column">
            <h4>الخدمات</h4>
            <ul class="footer-list">
                 <li><a href="https://os-desin.vercel.app/logo/logo.html">شعار</a></li>
                <li><a href="https://os-desin.vercel.app/panar/panar.html">يفط و بنرات</a></li>
                <li><a href="https://os-desin.vercel.app/Social-media/Social-media.html">Social media | اعلانات</a></li>
                <li><a href="https://os-desin.vercel.app/logo-Teshrt/t-shert.html">طباعه علي تيشرت</a></li>
                <li><a href="https://os-desin.vercel.app/pepar/pepar.html">خدمات ورقيه</a></li>
            </ul>
        </div>
       
         <div class="footer-column">
             <h4>دراسه</h4>
            <ul class="footer-list">
             <li><a href="https://os-desin.vercel.app/teshar/teshar.html">خدمات مدرسين</a></li>

            </ul>
        </div>
        <div class="footer-column">
            <h4>التواصل</h4>
            <ul class="footer-list">
                <li><a href="tel:01144898934">اتصل بنا</a></li>
                <li><a href="https://wa.me/201144898934">تواصل واتساب</a></li>
                <li><a href="mailto:samasemo5647@gmail.com">تواصل عبر البريد الالكتروني</a></li>
            </ul>
        </div>
    </div>
    
    <div class="footer-bottom">
        <span>OS-Designer. © 2025. العلامة التجارية وجميع الحقوق محفوظة.</span>
        |
        <a href="https://maps.app.goo.gl/7onyXFjDYGyX34rU6"> موقعنا</a>
        <span class="country">مصر | Egypt</span>
    </div>
</footer>





    <!-- Firebase CDN -->
<script type="module">
  // Firebase إعداد
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAIL9B-CijJ_1jQelALW0hdXV2bzqBhjnw",
    authDomain: "storehub-manager.firebaseapp.com",
    projectId: "storehub-manager",
    storageBucket: "storehub-manager.firebasestorage.app",
    messagingSenderId: "584686051923",
    appId: "1:584686051923:web:3aad37de33ccc43dfa1ca6"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // بيانات محلية
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  let discount = parseFloat(localStorage.getItem("discount")) || 0.00;
  const shipping = 0.00;

  // حساب المجموع
  function calculateSubtotal() {
    return cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
  }

  // تحديث ملخص الطلب
  function updateSummary() {
    const subtotal = calculateSubtotal();
    const total = subtotal - discount + shipping;

    document.querySelector(".grand-total span:nth-child(2)").textContent = `${total.toFixed(2)} EGP`;
    document.querySelector(".total-row:nth-child(2) span:nth-child(2)").textContent = `-${discount.toFixed(2)} EGP`;
  }

  // عرض السلة
  function loadCartItems() {
    const container = document.getElementById("order-items-container");
    const totalsContainer = document.getElementById("order-totals-container");
    container.innerHTML = '';
    if (cart.length === 0) {
      container.innerHTML = "<p>لا توجد منتجات في سلة التسوق</p>";
      totalsContainer.innerHTML = '';
      return;
    }

    let subtotal = 0;
    cart.forEach(item => {
      container.innerHTML += `
        <div class="order-item">
          <div class="item-info">
            <img src="${item.image}" class="item-img">
            <div class="item-details">
              <h4>${item.name}</h4>
              <p>الكمية: ${item.quantity}</p>
            </div>
          </div>
          <div class="item-price">${(item.price * item.quantity).toFixed(2)} EGP</div>
        </div>`;
      subtotal += item.price * item.quantity;
    });

    const total = subtotal - discount + shipping;
    totalsContainer.innerHTML = `
      <div class="total-row"><span>المجموع الفرعي</span><span>${subtotal.toFixed(2)} EGP</span></div>
      <div class="total-row"><span>خصم</span><span>-${discount.toFixed(2)} EGP</span></div>
      <div class="total-row"><span>الشحن</span><span>${shipping.toFixed(2)} EGP</span></div>
      <div class="total-row grand-total"><span>الإجمالي</span><span>${total.toFixed(2)} EGP</span></div>
    `;
  }

  // تطبيق كود الخصم
  window.applyCoupon = function () {
    const input = document.getElementById("coupon-code");
    const code = input.value.trim();
    const subtotal = calculateSubtotal();
    if (code === "DISCOUNT10") {
      discount = subtotal * 0.1;
      alert("تم تطبيق خصم 10%");
    } else if (code === "DISCOUNT20") {
      discount = subtotal * 0.2;
      alert("تم تطبيق خصم 20%");
    } else {
      alert("كود الخصم غير صحيح");
      return;
    }
    localStorage.setItem("discount", discount);
    updateSummary();
    loadCartItems();
  };

  // حفظ البيانات المؤقتة
  const formFields = [
    "first-name", "last-name", "email", "phone", "address",
    "city","notes"
  ];

  function setupFormListeners() {
    formFields.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.value = localStorage.getItem(`form_${id}`) || "";
        el.addEventListener("input", () => {
          localStorage.setItem(`form_${id}`, el.value);
        });
      }
    });
  }

  // التحقق من الحقول
  function validateForm() {
    let valid = true;
    const required = ["first-name", "last-name", "email", "phone", "city"];
    required.forEach(id => {
      const el = document.getElementById(id);
      if (!el || !el.value.trim()) {
        el?.closest(".form-group")?.classList.add("error");
        valid = false;
      }
    });
    return valid;
  }

  // جمع البيانات
  function collectFormData() {
    const data = {};
    formFields.forEach(id => {
      data[id] = document.getElementById(id)?.value || "";
    });
    data.orderItems = cart;
    data.discount = discount;
    data.total = calculateSubtotal() - discount + shipping;
    data.createdAt = new Date().toISOString();
    return data;
  }

  // إرسال البيانات إلى Firestore
  async function sendOrderToFirestore(data) {
    try {
      const docRef = await addDoc(collection(db, "orders"), data);
      alert(`تم إرسال الطلب بنجاح دخول صفحه الفاتور`);
      // إعادة توجيه المستخدم إلى صفحة الفاتورة
      localStorage.removeItem("cart");
      window.location.href = `invoice.html?id=${docRef.id}`;
    } catch (err) {
      alert("فشل في إرسال الطلب إلى قاعدة البيانات");
      console.error(err);
    }
  }

  // تنفيذ الطلب
  async function submitOrder(e) {
    e.preventDefault();
    if (!validateForm()) {
      alert("يرجى ملء جميع الحقول المطلوبة");
      return;
    }
    const data = collectFormData();
    await sendOrderToFirestore(data);
  }

  // عند تحميل الصفحة
  document.addEventListener("DOMContentLoaded", () => {
    loadCartItems();
    setupFormListeners();
    updateSummary();
    const submitBtn = document.querySelector(".submit-btn");
    submitBtn?.addEventListener("click", submitOrder);

    // إضافة كود الخصم
    const couponContainer = document.querySelector('.order-summary');
    if (couponContainer && !document.getElementById('coupon-code')) {
      couponContainer.insertAdjacentHTML('afterbegin', `
        <div class="coupon-section">
          <input type="text" id="coupon-code" placeholder="أدخل كود الخصم">
          <button onclick="applyCoupon()" class="coupon-btn" style="            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 0.8rem;
            width: 50%;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 1rem;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(74, 0, 224, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;">تطبيق الكود</button>
        </div>
      `);
    }
  });

  // حفظ البيانات عند التعديل
const inputs = document.querySelectorAll('input');
inputs.forEach(input => {
  input.addEventListener('input', () => {
    localStorage.setItem(input.id, input.value);
  });
});

window.addEventListener('DOMContentLoaded', () => {
  inputs.forEach(input => {
    const savedValue = localStorage.getItem(input.id);
    if (savedValue) {
      input.value = savedValue;
    }
  });
});

</script>


</body>
</html>